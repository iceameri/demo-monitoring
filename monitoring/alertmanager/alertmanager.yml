global:
  resolve_timeout: 5m

################################################################################
# ROUTING
################################################################################
route:
  receiver: "default-slack"

  # ì•ŒëžŒ ê·¸ë£¹ ê¸°ì¤€ (ì¤‘ìš”: ë…¸ì´ì¦ˆ ê°ì†Œ)
  group_by: ["alertname", "service"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h

  routes:
    ###########################################################################
    # 1ï¸âƒ£ ë°°í¬ / ì ê²€ ì¤‘ ì•ŒëžŒ ì–µì œìš© (Silenceì™€ ë³‘í–‰)
    ###########################################################################
    - matchers:
        - maintenance="true"
      receiver: "null-receiver"

    ###########################################################################
    # 2ï¸âƒ£ SLO / Error Budget ì•ŒëžŒ
    ###########################################################################
    - matchers:
        - slo="availability"
        - severity="critical"
      receiver: "slo-critical"

    - matchers:
        - slo="availability"
        - severity="warning"
      receiver: "slo-warning"

    ###########################################################################
    # 3ï¸âƒ£ ì„œë¹„ìŠ¤ë³„ ë¼ìš°íŒ…
    ###########################################################################
    - matchers:
        - service="payment-service"
      receiver: "payment-team-slack"

    - matchers:
        - service="demo-monitoring-service"
        - severity="critical"
      receiver: "backend-critical"

    - matchers:
        - service="demo-monitoring-service"
        - severity="warning"
      receiver: "backend-warning"

################################################################################
# RECEIVERS
################################################################################
receivers:
  ###########################################################################
  # ê¸°ë³¸ (fallback)
  ###########################################################################
  - name: "default-slack"
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX"
        channel: "#alerts-common"
        title: "[{{ .CommonLabels.service }}] {{ .CommonAnnotations.summary }}"
        text: >-
          {{ range .Alerts }}
          *Service:* {{ .Labels.service }}
          *Severity:* {{ .Labels.severity }}
          *Description:* {{ .Annotations.description }}
          {{ end }}

  ###########################################################################
  # Backend - Critical
  ###########################################################################
  - name: "backend-critical"
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX"
        channel: "#alerts-backend-critical"
        title: ":rotating_light: [CRITICAL][{{ .CommonLabels.service }}] {{ .CommonAnnotations.summary }}"
        text: >-
          *ðŸš¨ ìž¥ì•  ë°œìƒ*

          *ì„œë¹„ìŠ¤:* {{ .CommonLabels.service }}
          *ì‹¬ê°ë„:* {{ .CommonLabels.severity }}
          *ì˜í–¥:* {{ .CommonAnnotations.description }}
          *ë°œìƒ ì‹œê°:* {{ .StartsAt }}

          *ì¦‰ì‹œ ì¡°ì¹˜*
          1. Grafana Runbook ëŒ€ì‹œë³´ë“œ í™•ì¸
          2. ìµœê·¼ ë°°í¬ ì—¬ë¶€ í™•ì¸
          3. ë¡¤ë°± ë˜ëŠ” ìž¬ê¸°ë™ íŒë‹¨

          *ðŸ”— ë°”ë¡œê°€ê¸°*
          â€¢ Grafana: https://grafana.company.com/d/runbook-demo
          â€¢ Runbook: https://wiki.company.com/runbooks/{{ .CommonLabels.alertname }}

          *On-call:* @backend-oncall

  ###########################################################################
  # Backend - Warning
  ###########################################################################
  - name: "backend-warning"
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX"
        channel: "#alerts-backend-warning"
        title: ":warning: [WARNING][{{ .CommonLabels.service }}] {{ .CommonAnnotations.summary }}"
        text: >-
          *âš ï¸ ì´ìƒ ì§•í›„ ê°ì§€*

          *ì„œë¹„ìŠ¤:* {{ .CommonLabels.service }}
          *ì§€í‘œ:* {{ .CommonAnnotations.description }}
          *ì‹¬ê°ë„:* {{ .CommonLabels.severity }}

          *ê¶Œìž¥ í–‰ë™*
          â€¢ Grafana ì§€í‘œ ì¶”ì´ í™•ì¸
          â€¢ ì¶”ê°€ ì•…í™” ì—¬ë¶€ ëª¨ë‹ˆí„°ë§

          *ðŸ”— Grafana*
          https://grafana.company.com/d/runbook-demo

  ###########################################################################
  # Payment Team
  ###########################################################################
  - name: "payment-team-slack"
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX"
        channel: "#alerts-payment"
        title: ":rotating_light: [{{ .CommonLabels.service }}] {{ .CommonAnnotations.summary }}"
        text: >-
          *ðŸ’³ ê²°ì œ ì„œë¹„ìŠ¤ ì•ŒëžŒ*

          *Severity:* {{ .CommonLabels.severity }}
          *Description:* {{ .CommonAnnotations.description }}

          *ðŸ”— Grafana*
          https://grafana.company.com/d/payment-service

  ###########################################################################
  # SLO - Critical
  ###########################################################################
  - name: "slo-critical"
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX"
        channel: "#alerts-slo"
        title: ":chart_with_downwards_trend: [SLO CRITICAL][{{ .CommonLabels.service }}]"
        text: >-
          *ðŸ“‰ Error Budget ì†Œì§„ ìž„ë°•*

          *SLO:* {{ .CommonLabels.slo }}
          *ì˜í–¥:* {{ .CommonAnnotations.description }}

          *ì¡°ì¹˜*
          â€¢ ì‹ ê·œ ë°°í¬ ì¤‘ë‹¨
          â€¢ ì•ˆì •í™” ìž‘ì—… ìš°ì„ 

          *ðŸ”— SLO ëŒ€ì‹œë³´ë“œ*
          https://grafana.company.com/d/slo-dashboard

  ###########################################################################
  # SLO - Warning
  ###########################################################################
  - name: "slo-warning"
    slack_configs:
      - api_url: "https://hooks.slack.com/services/XXX"
        channel: "#alerts-slo"
        title: ":warning: [SLO WARNING][{{ .CommonLabels.service }}]"
        text: >-
          *ðŸ“Š SLO ìœ„í—˜ ì‹ í˜¸*

          *SLO:* {{ .CommonLabels.slo }}
          *ì„¤ëª…:* {{ .CommonAnnotations.description }}

          *ðŸ”— SLO ëŒ€ì‹œë³´ë“œ*
          https://grafana.company.com/d/slo-dashboard

  ###########################################################################
  # Null Receiver (Silence / Maintenance)
  ###########################################################################
  - name: "null-receiver"

################################################################################
# INHIBITIONS (ì¤‘ë³µ ì•ŒëžŒ ì–µì œ)
################################################################################
inhibit_rules:
  - source_matchers:
      - severity="critical"
    target_matchers:
      - severity="warning"
    equal: ["alertname", "service"]
